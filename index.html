<html>
<head>
        <title>Mental health care deserts</title>
        <link rel="stylesheet" href="style.css">
        <meta name="viewport" content="width =device-width, initial-scale =1">
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <meta charset='utf-8'/>
        <title>Mental health facilities</title>
        <meta name='viewport' content='width=device-width, initial-scale=1' />
        <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v2.8.1/mapbox-gl.js'></script>
        <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v2.8.1/mapbox-gl.css' rel='stylesheet' />
        <script src='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.0/mapbox-gl-geocoder.min.js'></script>
        <link rel='stylesheet' href='https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.7.0/mapbox-gl-geocoder.css' type='text/css' />
        <style>
            #map {
                height: 500px;
                width: 100%;
                position:sticky;
                padding-top: 20px;
            }
        </style>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Radio+Canada&display=swap" rel="stylesheet">
    <title>Embedding Vega-Lite</title>
    <script src="https://cdn.jsdelivr.net/npm/vega@5.21.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-lite@5.2.0"></script>
    <script src="https://cdn.jsdelivr.net/npm/vega-embed@6.20.2"></script>
</head>
<body>
<section id="banner">
        <div class="banner-text">
            <h1>Mental Health Care Deserts</h1>
            <p>Mental health disorders are among the most common health conditions faced by Californians: Nearly 1 in 6 California adults experience a mental illness of some kind, and 1 in 24 have a serious mental illness that makes it difficult to carry out major life activities.</p>
            <div class="banner-btn">
                <a href="https://calmatters.org/children-and-youth/2022/04/childrens-mental-health-california/"><span></span> Read more about mental health in California here</a>

            </div>
        </div>
</section>
<section id="feature">
    <div class="title-text">
    <p>FIND THE MENTAL HEALTH YOU NEED</p>
    <h1>WITH OUR SEARCH TOOL</h1>
    <!-- <div class="container">
        <form action="https://www.google.com/search" method="get" class="search-bar">
            <input type="text" placeholder="Introduce your address" name="q">
            <button type="submit"><img src="images/search.png"></button>
        </form>
    <div>
    -->
    </div>
<div id='map'>
</div>
<script>
    mapboxgl.accessToken = 'pk.eyJ1IjoiZnJhbnByaW5jZXNzMTk5NSIsImEiOiJjbDJvMmNhd3cyNnRzM2VzYjNkdGtia2d6In0.TAFYy_RFMRMI5UOyo3ZggQ';
    const map = new mapboxgl.Map({
        container: 'map',
        style: 'mapbox://styles/mapbox/light-v10',
        center: [-119.417931, 36.778259],
        zoom: 5.0
    });
    map.on('load', () => {
        const geocoder = new MapboxGeocoder({
            accessToken: mapboxgl.accessToken,
            mapboxgl: mapboxgl,
            zoom:10,
            placeholder:'Enter an address or place name',
            bbox: [-124.410607,32.534231,-114.134458,42.009659]
        });
        map.addControl(geocoder, 'top-left');
        const marker = new mapboxgl.Marker({ color:'#FF7F50'});
        geocoder.on('result', async (event) =>{
            const point = event.result.center;
            const tileset ='franprincess1995.5mmmo9io';
            const radius = 3218;
            const limit = 50;
            marker.setLngLat(point).addTo(map);

            const query=await fetch(
            `https://api.mapbox.com/v4/${tileset}/tilequery/${point[0]},${point[1]}.json?radius=${radius}&limit= ${limit} &access_token=${mapboxgl.accessToken}`,
                { method: 'GET' }
            );
            const json = await query.json();
            map.getSource('tilequery').setData(json);
        });
        map.addSource('tilequery', {
            type: 'geojson',
            data: {
                'type': 'FeatureCollection',
                'features': []
            }
        });
        map.addLayer({
            id:'tilequery-points',
            type: 'circle',
            source: 'tilequery',
            paint: {
                'circle-stroke-color': 'white',
                'circle-stroke-width': {
                    stops: [
                        [0, 0.1],
                        [18, 3]
                    ],
                    base: 5
                },
                'circle-radius': {
                    stops: [
                        [12, 5],
                        [22, 180]
                    ],
                    base: 5
                },
                'circle-color': [
                    'match',
                    ['get', 'facility_type'],
                    'APH',
                    '#03a8a0',
                    'MHRC',
                    '#039c4b',
                    'NARCOTICS',
                    '#fedf17',
                    'NON',
                    '#ff0984',
                    'NON-DETOX',
                    '#21409a',
                    'PHF',
                    '#04adff',
                    'PSYCHC',
                    '#db6ff2',
                    'RES',
                    '#750c8c',
                    'RES-DETOX',
                    '#340c54',
                    '#FF0000'
                ]
            }

        });
        const popup = new mapboxgl.Popup();

        map.on('mouseenter', 'tilequery-points', (event) => {
            map.getCanvas().style.cursor = 'pointer';
            const properties = event.features[0].properties;
            const obj = JSON.parse(properties.tilequery);
            const coordinates = new mapboxgl.LngLat(
                properties.longitude,
                properties.latitude
            );
            const content = `<h3>Facility Name: ${properties.facility_name}</h3><h4>Type of Facility: ${properties.facility_type}</h4><p>${properties.address}</p><p>${properties.phone_number}</p><p>Notes: ${properties.other_details}</p><p>${(obj.distance/1609).toFixed(2)} miles from location</p>`;
            popup.setLngLat(coordinates).setHTML(content).addTo(map)
            ;
        });
        map.on('mouseleave', 'tilequery-points', () => {
            map.getCanvas().style.cursor = '';
            popup.remove();
        });
    });
</script>

<div id="sideNav">
    <nav>
    <ul>
        <li><a href="#">HOME</a></li>
        <li><a href="#">DATA</a></li>
        <li><a href="#">SEARCH</a></li>
        <li><a href="#">NEWS</a></li>
    </ul>
    </nav>
</div>
<div id="menuBtn">
    <img src="add_img/menu.png" id="menu">
</div>


<!--Features-->


</div>
</div>
<div class="feature-box">
    <div class="features">
        <h1>CALIFORNIA MENTAL HEALTH CARE IN FIGURES </h1>
    </div>
</div>
</section>


<script>
var menuBtn = document.getElementById("menuBtn")
var sideNav = document.getElementById("sideNav")
var menu = document.getElementById("menu")

sideNav.style.right = "-250px";

menuBtn.onclick = function(){
    if(sideNav.style.right == "-250px"){
       sideNav.style.right = "0";
    }
    else{
         sideNav.style.right = "-250px";

    }
}
</script>

<div id="vis"></div>

    <script type="text/javascript">
      var yourVlSpec = {
        $schema: 'https://vega.github.io/schema/vega-lite/v5.json',
        description: 'A simple bar chart with embedded data.',
        data: {
          values: [
            {a: 'A', b: 28},
            {a: 'B', b: 55},
            {a: 'C', b: 43},
            {a: 'D', b: 91},
            {a: 'E', b: 81},
            {a: 'F', b: 53},
            {a: 'G', b: 19},
            {a: 'H', b: 87},
            {a: 'I', b: 52}
          ]
        },
        mark: 'bar',
        encoding: {
          x: {field: 'a', type: 'ordinal'},
          y: {field: 'b', type: 'quantitative'}
        }
      };
      vegaEmbed('#vis', yourVlSpec);
    </script>

</body>
</html>